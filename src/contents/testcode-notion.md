---
title: 'Test Code'
---

- [TEST Code 의 필요성](#test-code-의-필요성)
- [Test 종류](#test-종류)
- [단언 과 테스트 더블](#단언-과-테스트-더블)
  - [단언 (Assertion)](#단언-assertion)
  - [테스트 더블](#테스트-더블)
- [테스트 코드 기본 구조](#테스트-코드-기본-구조)

# TEST Code 의 필요성

개발시 새로운 수정사항을 반영할 경우, 기존 코드에 대한 검증 및 사이드 이펙트에 대한 검증이 필요하다. 이러한 문제들을 해결할 수 있는 것이 테스트 코드. 탄탄한 테스트 코드는 새로운 변화에 유동적으로 대응할 수 있으며 해당 코드에 대한 확신을 가질 수 있도록 해준다.

# Test 종류

테스트에는 **단위테스트**, **통합테스트**, 그리고 **E2E** 테스트로 나눌 수 있다.

- **단위 테스트 ( unit Test )**
  - 특징
    - **개발자의 관점**에서 테스트 하는 경우 사용
    - 가장 최소단위의 테스트로, 일반적으로 모듈 단위
    - 하나의 모듈이나 클래스에 대해 세밀한 테스트가 가능하며 넓은 범위보다 빠르게 실행가능
  - 단점
    - 테스트를 위해 모의 객체(mocking)를 사용해야하며, 각 모듈이 실제로 잘 연결되어 상호 작용하는지에 대해서 검증 불가
    - 사소한 변경에도 영향을 받기 때문에 작은 단위의 리팩토링에도 쉽게 깨짐
- **통합 테스트 ( Integration Test )**

  - 특징
    - **개발자의 관점**에서 테스트 하는 경우 사용
    - 단위 테스트 보다 넓은 범위의 테스트로, 2개 이상의 모듈을 연결하여 진행하는 테스트
    - 서비스 로직을 실행했을 때, 알맞은 데이터를 제공하는지, 올바른 로직을 수행하는지 등을 테스트 함
    - 단위 테스트에 비해 모의 객체의 사용이 적으며, 모듈 간의 연결에서 발생하는 에러 검증 가능
    - 단위 테스트와 비교해 리팩토링을 할 때 쉽게 깨지지 않음
  - 단점
    - 복잡한 알고리즘이나 분기문을 갖고 있을 때 테스트가 번거롭고, 테스트 중복이 발생할 확률이 높음

- **E2E Test ( End to End Test )**
  - 특징
    - **사용자의 관점**에서 테스트 하는 경우 사용
    - 사용자가 움직일 거라 예상하는 시나리오를 script 를 이용하여 매크로처럼 브라우저 내에서 자동으로 실행하는 방식
    - 실제 사용자가 사용하는 상황에서 발생하는 에러를 사전에 확인 가능
    - 브라우저를 외부에서 직접 제어 하여 자바스크립트의 API만으로는 제어할 수 없는 행위(브라우저 크기 변경, 실제 키보드 입력 등) 테스트 가능
    - 테스트 코드가 실제 코드 내부 구조에 영향을 받지 않으므로 리팩토링에 의해 깨지지 않음
  - 단점
    - 테스트의 실행 속도가 느리기 때문에 개발 단계에서 빠른 피드백을 받기가 어려움
    - 통제된 샌드박스 환경에서의 테스트가 아니므로 테스트 실행 환경의 예상하지 못한 문제들(네트워크 오류, 프로세스 대기로 인한 타임아웃 등)로 인해 테스트가 가끔 실패하는 일이 발생 - 테스트를 100% 신뢰할 수 없는 문제
      > <small>library : Selenium WebDriver, Cypress, TestCafe ...</small>

# 단언 과 테스트 더블

테스트 코드는 주로 테스트를 위한 **초기화**와 **단언**으로 이루어집니다.

## 단언 (Assertion)

- 개별 테스트가 **통과하기 위한 조건을 명확하게 기술**하기 위해 사용
- 테스트 프레임워크에서 기본적으로 다양한 단언 API를 제공
- 대부분의 단언 라이브러리들이 사용자들이 필요에 따라 자신만의 단언을 추가하여 사용 가능한 플러그인 확장 기능 제공

<small>ex) `expect()` 와 함께 `toBeNull()`, `toEqual()`, `toHaveBeenCalled()` 등... 다양한 단언 사용 가능</small>

## 테스트 더블

- 실제로 테스트하기 곤란한 객체(외부 의존성 객체)를 대신하여 **테스트를 위해서만 동작하는 객체**를 제작하여 테스트 하는 단위 테스트 패턴
- 단언과 마찬가지로 테스트 더블을 위한 함수들도 테스트 프레임워크에서 기본 제공
- 일반적으로 자바스크립트 객체 혹은 함수를 직접 변경하거나 생성하는 형태로 사용
- 특정한 동작을 흉내만 낼 뿐이지만 테스트 하기에는 적합

일반적으로 다음 가지를 통칭하여 테스트 더블이라 칭합니다.

- **더미 (dummy)** :: 파라미터로 사용되며 실제 사용되진 않음
- **스텁 (sturb)** :: 더미를 개선하여 실제 동작하게끔 만든 것. 리턴 값을 하드 코딩함
- **스파이 (spy)** :: 스텁과 유사. 내부적으로 기록을 남기는 추가 기능. 특정 메서드가 호출되었는지 등의 상황 감시
- **페이크 (fake)** :: 스텁에서 발전한 실제 코드. 운영에서는 사용 불가
- **목 (mock)** :: 더미, 스텁, 스파이를 혼합한 형태

# 테스트 코드 기본 구조

일반적으로 테스트 케이스 코드는 라이브러리마다 유사한 API로 구성 가능 합니다.

- 기본 파일명
  - `/**/*.test.js`
  - `/**/*.spec.js`
    > 구체화 (specification) 의 약자입니다. 테스트에서 구체화란, 기술적으로 주어진 코드의 단위가 성공적으로 수행되어야 한다는 것을 의미합니다.

두 파일명의 차이는 없으며, 테스트 파일을 그룹화하여 테스트 러너가 로드할 파일 또는 찾을 파일을 알게해줍니다.

- 기본 구조

| method               | desc                                                                                                                                                                   |
| -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `describe()`         | `test()` 코드를 하나의 테스트 작업 단위로 묶어주는 API.<br>하나의 테스트 케이스를 `test()` 라고 한다면 `describe()` 는 여러개의 테스트 케이스를 하나의 그룹으로 묶어줌 |
| `beforeEach()`       | 각 테스트 전에 실행                                                                                                                                                    |
| `afterEach()`        | 각 테스트 후에 실행                                                                                                                                                    |
| `it()` 또는 `test()` | 테스트 코드를 돌리기 위한 API. 하나의 테스트 케이스를 의미. `it()` 대신 `test()` 를 사용할 수 있습니다.                                                                |
| `expect()`           | 테스트를 할 대상을 넣는 API. 주로 테스트 입력값 또는 기대 값 입력                                                                                                      |
| `toBe()`             | 단언 - 테스트의 결과를 확인하는 API. 기타 다른 API 는 [문서](https://jestjs.io/docs/api) (Jest 기준) 를 확인하세요                                                     |

```js
describe('A_module 테스트', () => {
  beforeEach(() => {
    // ...각 테스트 전에 실행
  })

  afterEach(() => {
    // ...각 테스트 이후에 실행
  })

  describe(
    ('A_module.a_method 테스트',
    () => {
      it('a_method 테스트 1', () => {
        // ...
      })

      test('a_method 테스트 2', () => {
        // ...
        expect(/* ... */).toBe(/* ... */)
      })
    })
  )
})
```

---

출처
[GOGO Tistory](https://gogomalibu.tistory.com/138) ,
[kijungsong.github](https://kijungsong.github.io/2020/04/15/javascript-test-jasmine/),
[cypress 환경 구축하기](https://class101.dev/ko/blog/2020/06/24/han/),
[jest puppetter](https://www.loginradius.com/blog/async/e2e-testing-with-jest-puppeteer/),
[Cracking Vue.js](https://joshua1988.github.io/vue-camp/testing/jest-testing.html#jest-api),
[Toast UI](https://ui.toast.com/fe-guide/ko_TEST#%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8F%84%EA%B5%AC)
